# Lessons Learned

## 2026-02-03: Do not interpret filenames as run instructions
**Mistake**: Assumed "nomsa" in a config filename meant "run without MSA flags". In reality, it meant the JSON file itself does not contain pre-computed MSA data, so MSA must be generated by the pipeline.
**Rule**: Never infer pipeline flags from config filenames. Always ask the user what flags to use, or use the same flags as previous runs unless told otherwise.

## 2026-02-03: Use precomputed MSA configs when re-running with new parameters
**Mistake**: When adding CDR regions and re-running, copied flags from the previous `run_pipeline.sh` which included `--use_af3_msa_for_embedding` and `--use_pocket_msa_for_embedding`, triggering a slow MSA database search from scratch. Should have converted the existing AF3 output JSON (which already contains precomputed MSA) using `convert_af3_to_siteaf3.py` and run without MSA generation flags.
**Rule**: When re-running the pipeline with a parameter change (like CDR regions), prefer using the converted JSON with precomputed MSA data (`convert_af3_to_siteaf3.py`). Only use `--use_af3_msa_for_embedding` etc. when MSA needs to be generated from scratch (i.e. no prior AF3 run exists). **However**, precomputed MSA from AF3 only works if the AF3 input sequence matches the receptor PDB sequence exactly. If the AF3 run used a longer/different sequence than the PDB (e.g. full RBD vs truncated PDB), the MSA first sequence won't match and featurisation will fail. In that case, regenerate MSA from scratch using the `_nomsa` config with MSA flags.
